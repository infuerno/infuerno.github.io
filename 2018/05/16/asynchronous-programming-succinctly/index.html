<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Asynchronous Programming Succinctly</title>
		<meta name="description" content="There are 18 different shades of British Standard Toast">
		<meta name="generator" content="Eleventy v3.1.2">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter,
		DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-10: #f7f7f7;
	--color-gray-15: #f0f0f0;
	--color-gray-20: #e0e0e0;
	--color-gray-30: #d0d0d0;
	--color-gray-40: #dedede;
	--color-gray-50: #c0c0c0;
	--color-gray-60: #b0b0b0;
	--color-gray-70: #a0a0a0;
	--color-gray-90: #333;

	--background-color: #fff;
	--text-color: var(--color-gray-90);

	--text-color-link-header: #082840;
	--text-color-link-active-header: #5f2b48;
	--text-color-link-visited-header: #17050f;
	--text-color-link: #27c0df;
	--text-color-link-visited: #27c0df;
	--text-color-link-active: #21daff;

	--text-color-link: #08cb00;
	--text-color-link-visited: #253900;
	--text-color-link-active: #09ff00;
	--text-color-code: #efe;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
	line-height: 1.5;
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img {
	max-width: 100%;
}
img[width][height] {
	height: auto;
}
img[src$=".svg"] {
	width: 100%;
	height: auto;
	max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
/* added to body instead */
/* p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
} */

header a[href] {
	color: var(--text-color-link-header);
}
header a[href]:visited {
	color: var(--text-color-link-visited-header);
}
header a[href]:hover,
header a[href]:active {
	color: var(--text-color-link-active-header);
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: 0.5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
:not(pre) > code {
	border: 1px solid #e8e8e8;
	border-radius: 3px;
	background-color: #eef;
	background-color: #cceeff;
	background-color: var(--text-color-code);
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
	background-color: #eef;
	background-color: #cceeff;
	background-color: var(--text-color-code);
	padding: 1em;
	border-radius: 0.3em;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1.2em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: 0.5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
	padding-left: 5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: 0.25em;
	padding-right: 0.5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	border-left: 4px solid var(--color-gray-20);
	margin-left: 0;
	margin-right: 0;
	padding-left: 1em;
	color: var(--color-gray-70);
	letter-spacing: -1px;
	font-style: italic;
	font-size: 1.05em;
}

table {
	margin-bottom: 30px;
	width: 100%;
	text-align: left;
	color: var(--color-gray-90);
	border-collapse: collapse;
	/*border: 1px solid #e8e8e8;*/
}

table tr:nth-child(even) {
	background-color: var(--color-gray-10);
}

table th,
table td {
	padding: 10px 15px;
}

table th {
	background-color: var(--color-gray-15);
	border: 1px solid var(--color-gray-40);
	border-bottom-color: var(--color-gray-60);
}

table td {
	border: 1px solid var(--color-gray-20);
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/infuerno.github.io/" class="home-link">infuerno.github.io</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/infuerno.github.io/">Home</a></li>
					<li class="nav-item"><a href="/infuerno.github.io/about/">About</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="asynchronous-programming-succinctly">Asynchronous Programming Succinctly</h1>

<ul class="post-metadata">
	<li><time datetime="2018-05-16">16 May 2018</time></li>
</ul>

<h2 id="chapter-1-getting-started">Chapter 1 Getting Started</h2>
<ul>
<li>Any process that accesses the UI thread (UI-related tasks usually share a <strong>single</strong> thread) will be blocked in a synchronous application.</li>
</ul>
<h3 id="writing-async-methods">Writing async methods</h3>
<p>The <code>async</code> and <code>await</code> keywords are used to denote asynchronous methods:</p>
<ul>
<li>The <code>async</code> modifier must be used in the method signature</li>
<li>Return type must be <code>Task&lt;T&gt;</code>, <code>Task</code> or <code>void</code> (event handlers only)</li>
<li>Has to contain at least one <code>await</code></li>
<li>(optional) Name should end in <code>Async</code> e.g. <code>GetBrokenLinksAsync</code></li>
</ul>
<p>NOTE: methods are not awaitable - types are awaitable. Hence you await a <code>Task&lt;TResult&gt;</code> or a <code>Task</code></p>
<pre><code>        private async void btnName_Click(object sender, EventArgs e)
        {
            string text = await ReadTextAsync();
            lblName.Text += text;
        }

        private async Task&lt;string&gt; ReadTextAsync()
        {
            await Task.Delay(TimeSpan.FromSeconds(4));
            return &quot;ola!&quot;;
        }
</code></pre>
<p>NOTE: don’t return <code>void</code> unless creating an async event handler e.g. btnName_Click above. Methods should return <code>Task</code> if they return nothing or <code>Task&lt;T&gt;</code> if they return a value</p>
<h3 id="avoid-deadlocks">Avoid deadlocks</h3>
<p>Deadlocks can occur if mixing synchronous and asynchronous code. If a method calls an asynchronous method, but does not await the result (i.e. calls it synchronously) a deadlock can occur.</p>
<p>This is due to contexts:</p>
<ul>
<li>A windows form application uses a UI thread = UI context</li>
<li>An <a href="http://ASP.NET">ASP.NET</a> application has an <a href="http://ASP.NET">ASP.NET</a> request context</li>
<li>If neither, the thread pool context is used</li>
</ul>
<p>A method run on a button click which is not itself an asynchronous method, but which calls an asynchronous method will block the UI context thread. However when the async method it is calling is ready to return, it will wait patiently for the UI context so it can finish - it continues on the same context which started it. Deadlock.</p>
<p>Two solutions:</p>
<ol>
<li>Use <code>async</code> all the way down</li>
<li><code>Use ConfigureAwait(false)</code> - tells the async method not to resume on the context</li>
</ol>
<h2 id="chapter-2-how-do-i-use-async">Chapter 2 How Do I Use Async</h2>
<p>For a method returning <code>Task&lt;T&gt;</code>, call the method as any other that returns a value, but additionally <code>await</code>ing it:</p>
<pre><code>`int age = await GetAge(birthday);`
</code></pre>
<p>Alternatively, define the task and then await it in two seperate lines:</p>
<pre><code>    Task&lt;int&gt; ageTask = GetAge(birthday);
    int age = await ageTask;

</code></pre>
<p>Use async with the factory pattern to create a new object asynchronously:</p>
<pre><code>    private async Task&lt;Person&gt; CreatePerson(string firstName, string lastName, DateTime dateofbirth) {
        // process which creates a person and requires something asynchronous
        return person;
    }

    Person person = await CreatePerson(&quot;Dirk&quot;, &quot;Gently&quot;, new DateTime(1975, 1, 1));
</code></pre>
<h3 id="cancel-an-async-task">Cancel an async task</h3>
<p>Cancelling async tasks requires a CancellationToken object to be passed to the async method. If the async method is cancelled, it throws an <code>OperationCancelledException</code>.</p>
<ul>
<li>Instantiate a CancellationTokenSource object in the top most method e.g. <code>var cancelSource = new CancellationTokenSource</code></li>
<li>Filter a token down through the async methods e.g. <code>cancelSource.Token</code></li>
<li>Cancel the task by calling <code>Cancel()</code> on the cancel source object e.g. <code>cancelSource.Cancel()</code></li>
<li>Ensure the <code>cancelSource</code> is set to null at the end (why?)</li>
</ul>
<h3 id="cancel-after-a-specific-time">Cancel after a specific time</h3>
<p>If no response has been received after a specific time, this allows us to cancel the task. In a similay way to above, explicitly call <code>cancelSource.CancelAfter(3000)</code> prior to calling the async method and passing in a token.</p>
<h3 id="await-in-catch-and-finally">Await in catch and finally</h3>
<p>Also possible. e.g. call a web page and if not returned, load from back up.</p>
<h3 id="abstract-classes-and-interfaces">Abstract classes and interfaces</h3>
<p>Abstract methods and interface methods are declared to return either <code>Task</code> or <code>Task&lt;T&gt;</code> as approprirate, but the <code>async</code> keyword is not used. When overriding or implementing the method, just need to add the <code>async</code> keyword.</p>
<h2 id="chapter-3-real-world-examples">Chapter 3 Real World Examples</h2>
<p>Bake in asynchronous functionality from the start. In particular consider reporting progress to the user. Use the <code>IProgress</code> interface with the Windows Progress bar in a win forms application to do this.</p>
<h3 id="displaying-the-progress-of-an-async-method">Displaying the progress of an async method</h3>
<p>Use an <code>IProgress&lt;T&gt;</code> parameter to your async method to be able to report on progress via the <code>progress.Report(value)</code> method. The <code>IProgress&lt;T&gt;</code> allows you to defined a callback method which is run each time <code>.Report()</code> is called, passing in the value supplied to the callback method.</p>
<pre><code>    var progress = new Progress&lt;int&gt;(percent =&gt;
    {
        prgProgress.Value = percent;
        lblProgress.Text = $&quot;Processing... {percent}% done&quot;;
    });
</code></pre>
<h3 id="pausing-the-progress-of-an-async-method">Pausing the progress of an async method</h3>
<p><code>Task.Delay()</code> can be used to pause a task e.g. <code>Task.Delay(TimeSpan.FromSeconds(2))</code>. A cancellation token can additionally be passed to the <code>Delay</code> method e.g. <code>Task.Delay(TimeSpan.FromSeconds(2), cancelToken)</code>.</p>
<h3 id="using-task-whenall-to-wait-for-all-tasks-to-complete">Using Task.WhenAll() to wait for all tasks to complete</h3>
<p>Add all tasks as parameters to the Task.WhenAll method where a Task is an async method returning a Task e.g.</p>
<pre><code>private async Task DoSomething() { await ..... };
private async Task DoSomethingElse() { await ..... };

await Task.WhenAll(DoSomething(), DoSomethingElse());
</code></pre>
<p>Methods which return a <code>Task&lt;T&gt;</code> can be used with <code>Task.WhenAll()</code> and the return values available in a return type of array of type T i.e. <code>T[]</code></p>
<p>Tasks can alternatively be added to a list of type <code>List&lt;Task&gt;</code> and passed to the <code>Task.WhenAll()</code> method.</p>
<h3 id="using-task-whenany-to-wait-for-any-tasks-to-complete">Using Task.WhenAny() to wait for any tasks to complete</h3>
<p>Once one task completes, the others can be cancelled. Instantiate a new <code>CancellationTokenSource</code>, pass a token into each async method. When one method has returned, just called <code>Cancel()</code> on the <code>CancellationTokenSource</code> object.</p>
<h3 id="process-tasks-as-they-complete">Process tasks as they complete</h3>
<ol>
<li>Add tasks to a list</li>
<li>Use <code>Task.WhenAny()</code> which will return the first task to finish</li>
<li>Remove from the list of tasks (otherwise the same task will just be processed multiple times)</li>
<li>Process the result as necessary</li>
<li>Keep going with the next task</li>
</ol>
<h2 id="chapter-4-use-semaphoreslim-to-access-shared-data">Chapter 4 Use SemaphoreSlim to access shared data</h2>
<p><code>SemaphoreSlim</code> is a lighter version of the <code>Semaphore</code> class and is intended for use in a local app because it can be used only as a local Semaphore.</p>
<ol>
<li>Initialise a semaphore e.g. <code>var sem = new SemaphoreSlim(1)</code></li>
<li>Get a lock on the semaphore e.g. <code>await sem.WaitAsync()</code></li>
<li>Access the shared resource</li>
<li>Release the lock e.g. <code>sem.Release()</code> - potentially as the finally part of a try catch.</li>
</ol>
<h2 id="chapter-5-unit-tests-and-async-and-await">Chapter 5 Unit Tests and async and await</h2>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/infuerno.github.io/2018/05/12/pluralsight-asp-dot-net-mvc-4-fundamentals/">Pluralsight: ASP.NET MVC 4 Fundamentals</a></li><li class="links-nextprev-next">Next →<br><a href="/infuerno.github.io/2018/06/18/using-csla4-04-data-portal/">Using CSLA 4 04 Data Portal Configuration</a></li>
</ul>

			</heading-anchors>
		</main>

		<footer>
			<p>
				<em>Built with <a href="https://www.11ty.dev/">Eleventy v3.1.2</a></em>
			</p>
		</footer>

		<!-- This page `/2018/05/16/asynchronous-programming-succinctly/` was built on 2025-09-05T01:23:56.887Z -->
		<script type="module" src="/infuerno.github.io/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
