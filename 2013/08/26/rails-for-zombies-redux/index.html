<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Rails For Zombies Redux</title>
		<meta name="description" content="There are 18 different shades of British Standard Toast">
		<meta name="generator" content="Eleventy v3.1.2">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter,
		DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-10: #f7f7f7;
	--color-gray-15: #f0f0f0;
	--color-gray-20: #e0e0e0;
	--color-gray-30: #d0d0d0;
	--color-gray-40: #dedede;
	--color-gray-50: #c0c0c0;
	--color-gray-60: #b0b0b0;
	--color-gray-70: #a0a0a0;
	--color-gray-90: #333;

	--background-color: #fff;
	--text-color: var(--color-gray-90);

	--text-color-link-header: #082840;
	--text-color-link-active-header: #5f2b48;
	--text-color-link-visited-header: #17050f;
	--text-color-link: #27c0df;
	--text-color-link-visited: #27c0df;
	--text-color-link-active: #21daff;

	--text-color-link: #08cb00;
	--text-color-link-visited: #253900;
	--text-color-link-active: #09ff00;
	--text-color-code: #efe;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #c0c0c0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
	line-height: 1.5;
}
html {
	overflow-y: scroll;
}
body {
	max-width: 50em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img {
	max-width: 100%;
}
img[width][height] {
	height: auto;
}
img[src$=".svg"] {
	width: 100%;
	height: auto;
	max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
/* added to body instead */
/* p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
} */

header a[href] {
	color: var(--text-color-link-header);
}
header a[href]:visited {
	color: var(--text-color-link-visited-header);
}
header a[href]:hover,
header a[href]:active {
	color: var(--text-color-link-active-header);
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: 0.5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
:not(pre) > code {
	border: 1px solid #e8e8e8;
	border-radius: 3px;
	background-color: #eef;
	background-color: #cceeff;
	background-color: var(--text-color-code);
}
pre:not([class*="language-"]) {
	margin: 0.5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
	background-color: #eef;
	background-color: #cceeff;
	background-color: var(--text-color-code);
	padding: 1em;
	border-radius: 0.3em;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1.2em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: 0.5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
	padding-left: 5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: 0.25em;
	padding-right: 0.5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: 0.5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

blockquote {
	border-left: 4px solid var(--color-gray-20);
	margin-left: 0;
	margin-right: 0;
	padding-left: 1em;
	color: var(--color-gray-70);
	letter-spacing: -1px;
	font-style: italic;
	font-size: 1.05em;
}

table {
	margin-bottom: 30px;
	width: 100%;
	text-align: left;
	color: var(--color-gray-90);
	border-collapse: collapse;
	/*border: 1px solid #e8e8e8;*/
}

table tr:nth-child(even) {
	background-color: var(--color-gray-10);
}

table th,
table td {
	padding: 10px 15px;
}

table th {
	background-color: var(--color-gray-15);
	border: 1px solid var(--color-gray-40);
	border-bottom-color: var(--color-gray-60);
}

table td {
	border: 1px solid var(--color-gray-20);
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">infuerno.github.io</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="rails-for-zombies-redux">Rails For Zombies Redux</h1>

<ul class="post-metadata">
	<li><time datetime="2013-08-26">26 August 2013</time></li>
</ul>

<p>Reference: <a href="http://railsforzombies.org/">http://railsforzombies.org/</a></p>
<h2 id="level-1-deep-in-the-crud">Level 1: Deep in the CRUD</h2>
<p>Hash Recipe: <code>variable = { key: value }</code>
(this is new ruby syntax where <code>key: value</code> is short for <code>:key =&gt; value</code>)</p>
<p>Read Recipe:  <code>variable[:key] =&gt; value</code></p>
<p>Rails uses an ORM system to persist objects to a database and allow CRUD operations on this objects.
If a class is called e.g. <code>Tweet</code>, then the corresponding database table will be called <code>tweets</code>. Ids will be taken care of by the rails framework.
Class methods allow you</p>
<h3 id="create">Create</h3>
<p>Create a new object and call <code>save</code> to persist it to the database.</p>
<pre><code>t = Tweet.new
t.status = &quot;I &lt;3 brains&quot;
t.zombie = &quot;Jim&quot;
t.save
</code></pre>
<p>Alternatively, create the new object using a hash:</p>
<pre><code>t = Tweet.new(:status =&gt; &quot;I &lt;3 brains&quot;, :zombie =&gt; &quot;Jim&quot;)
t.save
</code></pre>
<p>Or all in one line using create</p>
<pre><code>Tweet.create(:status =&gt; &quot;I &lt;3 brains&quot;, :zombie =&gt; &quot;Jim&quot;)
</code></pre>
<h3 id="read">Read</h3>
<p>There are lots of ways to read information from the database:</p>
<pre><code>Tweet.find(2)		# find by id
Tweet.find(3,4,5)	# return multiple objects
Tweet.first			# returns the first tweet
Tweet.last
Tweet.all
Tweet.count			# returns the result of a select count(*) on the database
Tweet.order(:zombie)	# return the tweets ordered by :zombie
Tweet.limit(10)		# just 10 tweets
Tweet.where(:zombie == &quot;Ash&quot;)
Tweet.where(zombie: &quot;Ash&quot;)
Tweet.where(:zombie == &quot;Ash&quot;).order(:status).limit(10)
Tweet.where(zombie: &quot;Ash&quot;).order(:status).limit(10)
</code></pre>
<h3 id="update">Update</h3>
<p>Update an attribute and resave, or use <code>t.attributes</code> to assign a hash with the updates and then save.</p>
<pre><code>t = Tweet.find(3)
t.attributes = {:status =&gt; &quot;I really &lt;3 brains&quot;, :zombie =&gt; &quot;EyeballChomper&quot;}
t.save
</code></pre>
<p>Finally the <code>t.update(hash)</code> method to automatically update and save the entity back to the database.</p>
<h3 id="delete">Delete</h3>
<p>Delete objects using the method <code>destroy</code> on individual objects, or <code>destroy_all</code> to obliterate all at once.</p>
<pre><code>Tweet.find(2).destroy
Tweet.destroy_all
</code></pre>
<h2 id="level-2-models-taste-like-chicken">Level 2: Models taste like chicken</h2>
<p>In a rails application stack there are 4 components:</p>
<ul>
<li>Views</li>
<li>Models</li>
<li>XX</li>
<li>XX</li>
</ul>
<h3 id="models">Models</h3>
<p>Before using the model Tweet the class needs to be defined. This is saved in <code>app/models/tweet.rb</code> and defines a class which inherits from <code>ActiveRecord::Base</code> which maps the record to the table.</p>
<pre><code>class Tweet &lt; ActiveRecord::Base
	validates_presence_of :status
end
</code></pre>
<h3 id="validation">Validation</h3>
<p>To make fields mandatory use <code>validates_presence_of</code>.<br>
Lots of other validators are availble to validate the model before allowing persistence to the database.</p>
<p>Alternative syntax for Rails 3 allows validations to be combined on a single line:</p>
<pre><code>validates :status, :presence =&gt; true
validates :status, :length =&gt; { :minimum =&gt; 3}
validates :status, :presence =&gt; true, :length =&gt; { :minimum =&gt; 3}
</code></pre>
<h3 id="associations">Associations</h3>
<p>To express associations between objects e.g. between <code>Tweet</code>s and <code>Zombie</code>s there are the keywords <code>belongs_to</code> and <code>has_many</code> :</p>
<pre><code>class Tweet &lt; ActiveRecord::Base
	belongs_to :zombie # note - this is singular
end

class Zombie &lt; ActiveRecord::Base
	has_many :tweets
end
</code></pre>
<p>This relationship may be specified in one direction only (either way), or both.</p>
<p>To save a new tweet, retrieve the required zombie and then use create, passing in this zombie.</p>
<pre><code>z = Zombie.find(3)
t = Tweet.create(:status =&gt; &quot;Your eyelids taste like bacon&quot;, :zombie =&gt; z)
</code></pre>
<h2 id="level-3-the-views-ain-t-always-pretty">Level 3: The views ain’t always pretty</h2>
<p>The Ruby application stack has 4 components, Models on the bottom and Views second from the top.
Rails applications are organised by folder:</p>
<ul>
<li>app
<ul>
<li>views
<ul>
<li>layouts
<ul>
<li>application.html.erb # main layout boilerplate html code (headers etc)</li>
</ul>
</li>
<li>zombies</li>
<li>tweets
<ul>
<li>index.html.erb # lists all tweets</li>
<li>show.html.erb # views one tweet</li>
</ul>
</li>
</ul>
</li>
<li>models</li>
</ul>
</li>
<li>public
<ul>
<li>stylesheets</li>
<li>javascripts</li>
<li>images</li>
</ul>
</li>
</ul>
<p><code>.erb</code> stands for Embedded Ruby, which embeds ruby code inside html</p>
<h3 id="tags-used-in-html-files">Tags used in html files</h3>
<p><code>&lt;% %&gt;</code> to evaluate Ruby<br>
<code>&lt;%= %&gt;</code> to evaluate Ruby and print the result<br>
To indicate where to add the main content in the application.html.erb template file use <code>&lt;%=yield%&gt;</code></p>
<h3 id="additional-layout-components">Additional layout components</h3>
<p><code>&lt;%= stylesheet_link_tag :all %&gt;</code> will write out the appropriate html to include all stylesheets in the public/stylesheets directory<br>
<code>&lt;%= javascript_include_tag :defaults %&gt;</code> will include all the default javascript (jquery from Rails 3.1)
<code>&lt;%= csrf_meta_tag %&gt;</code> cross site request forgery meta tag will add meta tags to the top of the doc and other tags to forms</p>
<h3 id="root-path-and-images">Root path and images</h3>
<p>When a resource is requested by the browser it will automatically be searched for in the <code>public</code> folder first. If not found, the request will be sent to Rails.</p>
<h3 id="adding-a-link">Adding a link</h3>
<p>To add a link use <code>&lt;%= link_to [link text], [link path url] %&gt;</code><br>
So to link to the page for that zombie use e.g. <code>&lt;%= link_to tweet.zombie.name, zombie_path(tweet.zombie) %&gt;</code><br>
This can alternatively be written  <code>&lt;%= link_to [link text], [object to show] %&gt;</code><br>
e.g. <code>&lt;%= link_to tweet.zombie.name, tweet.zombie %&gt;</code></p>
<h3 id="getting-more-info-from-the-api-documentation">Getting more info from the API documentation</h3>
<p>There are many options you can use with the method <code>link_to</code>.
In order to find more information about this method:</p>
<ol>
<li><code>git clone</code> the rails code and use grep to search for that method name: <code>grep -rin 'def link_to'</code></li>
<li>Use the online documentation at <a href="http://api.rubyonrails.org">http://api.rubyonrails.org</a></li>
<li>Searchable online documentation with comments at <a href="http://apidock.com/rails">http://apidock.com/rails</a></li>
<li>Use the rails searchable API doc at <a href="http://railsapi.com">http://railsapi.com</a></li>
</ol>
<h3 id="link-to-paths">link_to paths</h3>
<p>When using <code>link_to</code> there are various macros to generate the correct RESTful style / MVC style url.</p>
<ul>
<li><code>tweets_path</code> to show all the tweets (<code>/tweets</code>)</li>
<li><code>new_tweet_path</code> to go to the page to add a new tweet (<code>/tweets/new</code>)</li>
<li><code>tweet_path(tweet)</code> or just <code>tweet</code> to go to the page for that tweet (e.g. <code>/tweets/1</code> or <code>tweets/1/show</code>)</li>
<li><code>edit_tweet_path(tweet)</code> to go to the edit page for that tweet (e.g. <code>/tweets/1/edit</code>)</li>
<li><code>tweet, :method =&gt; :delete</code> to delete a tweet (generates <code>/tweets/1</code>)</li>
</ul>
<p>These all follow the recipe:
<code>&lt;%= link_to text_to_show, code %&gt;</code></p>
<h2 id="level-4-controllers-must-be-eaten">Level 4: Controllers must be eaten</h2>
<p>In the Ruby application stack, Models is at the bottom, then Controllers and then Views second from top. All requests initially go to the controller.</p>
<ul>
<li>app
<ul>
<li>models</li>
<li>views</li>
<li>controllers
<ul>
<li>tweets_controllers.rb</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="naming-conventions">Naming conventions</h3>
<p>The name of the controller <code>tweets_controller</code> matches the path in the url <code>/tweets/</code>.</p>
<p>The controller class method name <code>show</code> also indicates the view which should be rendered, <code>show.html.erb</code>.</p>
<pre><code>class TweetsController &lt; ApplicationController
	def show
		@tweet = Tweet.find(params[:id])
	end
end
</code></pre>
<p>There is a way to override the name of the view which will be rendered by using the following code inside the controller method:</p>
<pre><code>render :action =&gt;  'status' # will render a view call status.html.erb
</code></pre>
<h3 id="variable-scope">Variable scope</h3>
<p>All calls to the model will be moved from the view to the controller. Now the view code doesn’t contain lots of Ruby code. The code in the controller action method will be executed and control passed to the view. Any variables required by the view will be marked with a <code>@</code>. The <code>@</code> symbol is then used both within the controller code and the view code.</p>
<h3 id="parameters">Parameters</h3>
<p>Parameters in the query string GET variables or in the POST variables are passed to the controller in a hash called <code>params</code>.
There are often nested hashes within the <code>params</code> hash (i.e. called with e.g. /tweets?tweet[status]=I’m dead)</p>
<pre><code>params = {:tweet =&gt; {:status =&gt; &quot;I'm dead&quot;}}
</code></pre>
<p>To extract this value we can use <code>params[:tweet][:status]</code>.</p>
<p>When creating a new tweet with this status, the code would be:</p>
<pre><code>@tweet = Tweet.create(:status =&gt; params[:tweet][:status])
</code></pre>
<p>or alternatively, just pass the hash from the params into the create method:</p>
<pre><code>@tweet = Tweet.create(params[:tweet])
</code></pre>
<p>NOTE: In Rails 4 strong paramters are required. This means in the controller you need to specify which models are required and which paramters for that model are permitted. Only required for creates or updates.</p>
<h3 id="generating-xml-and-json-formats">Generating xml and json formats</h3>
<p>By default in ruby the convention for requesting the output in a different format is to append <code>.xml</code> or <code>.json</code> on the end of the url e.g. <code>/tweets/1.xml</code>.</p>
<p>In the controller, the <code>respond_to</code> keyword is used:</p>
<pre><code>class TweetsController &lt; ApplicationController
	def show			
		@tweet = Tweet.find(params[:id])

		respond_to { |format| 
			format.html # show.html.erb
			format.xml { render :xml =&gt; @tweet }
			format.json { render :json =&gt; @tweet }
		}
	end
end
</code></pre>
<p>This will automatically render the tweet in either xml or json.</p>
<h3 id="common-controller-actions">Common controller actions</h3>
<pre><code>class TweetsController &lt; ApplicationController
	def index 	# show all items
	def show		# show a single item
	def new 		# show a create form
	def edit 		# show an edit form
	def create 	# create a new item
	def update 	# update an item
	def destroy	# delete an item
end
</code></pre>
<h3 id="authorisation">Authorisation</h3>
<p>The session hash can be used to store e.g. the user’s id and restrict edits to items only this user has created.</p>
<pre><code>class TweetsController &lt; ApplicationController
	def edit
		if session[:user_id] != @tweet.zombie_id
			flash[:notice] = &quot;Sorry, you can't edit this tweet&quot;
			redirect_to(tweets_path)
		end
	end
end
</code></pre>
<p>The flash hash is used to send messages to the user. To redirect the user back to a different controller, use the <code>redirect_to</code> method.</p>
<p>In Rails 3 the redirection and notice can be combined:</p>
<pre><code>redirect_to(tweets_path, :notice =&gt; &quot;Sorry, you can't edit this tweet&quot;)
</code></pre>
<h3 id="common-code-for-several-actions">Common code for several actions</h3>
<p>If there is common code which is called in several actions, this can be extracted to its own method.
This method can be called by using the <code>before_filter</code> command which can specify a method to execute, as well as conditions when the method should be executed.</p>
<pre><code>before_filter  :get_tweet, :only =&gt; [:edit, :update, :destroy]
before_filter  :check_auth, :only =&gt; [:edit, :update, :destroy]

def get_tweet
	@tweet = Tweet.find(params[:id])
end
def check_auth
	if session[:user_id] != @tweet.zombie_id
		redirect_to(tweets_path, :notice =&gt; &quot;Sorry, you can't edit this tweet&quot;)
	end
end
</code></pre>
<h2 id="level-5-routing-into-darkness">Level 5: Routing into darkness</h2>
<p>The final component in the ruby application stack is routing, sitting right at the top. Routes are required to properly find the paths for the link_to functions and find the actions.</p>
<p>They are defined in a file called routes.rb in the config directory.</p>
<ul>
<li>app
<ul>
<li>models</li>
<li>views</li>
<li>controllers</li>
</ul>
</li>
<li>config
<ul>
<li>routes.rb</li>
</ul>
</li>
</ul>
<p>This file contains code to create a RESTful resource to generate several default routes:</p>
<pre><code>ZombieTwitter::Application.routes.draw do |map| 
	resources :tweets
end
</code></pre>
<h3 id="custom-routes">Custom routes</h3>
<p>To specify custom routes:</p>
<pre><code>match 'new_tweet' =&gt; 'Tweets#new' # controller Tweets, action new
match 'all' =&gt; 'Tweets#index'
</code></pre>
<p>However, once you do this the usual <code>tweets_path</code> will still direct to <code>/tweets</code> instead of <code>/all</code>. We can define a path which will redirect to <code>/all</code> as part of the route, which we can then use with link_to.</p>
<pre><code>match 'all' =&gt; 'Tweets#index', :as =&gt; 'all_tweets&quot;'&quot;

&lt;%= link_to 'All tweets', all_tweets_path %&gt;
</code></pre>
<h3 id="redirects">Redirects</h3>
<p>Alternatively we may want to keep <code>/tweets</code>, but redirect to this if someone enters <code>/all</code>. This is done using the <code>redirect</code> keyword:</p>
<pre><code>match 'all' =&gt; redirect('/tweets')
match 'google' =&gt; redirect('http://www.google.com')
</code></pre>
<p>The second example shows this mechanism being used to redirect outside of the application.</p>
<h3 id="root-route">Root route</h3>
<p>Specify where the root of the application default to using the root route.</p>
<pre><code>root :to =&gt; &quot;Tweets#index&quot;
</code></pre>
<p>Correspondingly the link_to is:</p>
<pre><code>&lt;%= link_to &quot;All tweets&quot;, root_path %&gt;
</code></pre>
<h3 id="route-parameters">Route parameters</h3>
<p>By default a number after an action in the url is assigned to a variable called <code>id</code>, but an alternative variable name can be specified in the routing.</p>
<pre><code>match &quot;local_tweets/:zipcode&quot; =&gt; &quot;Tweets#index&quot;
</code></pre>
<p>Another example uses a variable without specifying any controller (as in e.g. <a href="http://www.twitter.com/user3">http://www.twitter.com/user3</a>)</p>
<pre><code>match &quot;:name&quot; =&gt; &quot;Tweets#index&quot;
</code></pre>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/2013/08/25/try-ruby/">Try Ruby</a></li><li class="links-nextprev-next">Next →<br><a href="/2013/08/27/whys-poignant-guide-to-ruby/">Why&#39;s Poignant Guide To Ruby</a></li>
</ul>

			</heading-anchors>
		</main>

		<footer>
			<p>
				<em>Built with <a href="https://www.11ty.dev/">Eleventy v3.1.2</a></em>
			</p>
		</footer>

		<!-- This page `/2013/08/26/rails-for-zombies-redux/` was built on 2025-09-05T01:35:40.161Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
