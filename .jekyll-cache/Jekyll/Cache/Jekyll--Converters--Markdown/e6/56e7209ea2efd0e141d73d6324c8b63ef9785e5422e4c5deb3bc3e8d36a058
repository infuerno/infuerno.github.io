I"ø<h3 id="references">References</h3>
<ul>
  <li>https://docs.microsoft.com/en-us/aspnet/whitepapers/mvc4-release-notes</li>
  <li>HTTP Fundamentals Pluralsight course</li>
</ul>

<h3 id="keyboard-shortcuts">Keyboard shortcuts</h3>
<ul>
  <li>Select multiple rows, hold down Alt and start typing</li>
</ul>

<h3 id="curl-options">Curl options</h3>
<ul>
  <li>-X specify method</li>
  <li>-V verbose e.g. show request and response headers being sent / received in full</li>
  <li>-H specify headers e.g. -H ‚ÄúAccept: application/json‚Äù</li>
</ul>

<h2 id="introduction-to-aspnet-mvc-4-part-1">Introduction to ASP.NET MVC 4 Part 1</h2>

<ul>
  <li>Entity framework can do efficient change tracking by adding additional features to your objects IF you make the properties virtual.</li>
  <li>Abstraction for the data source of <code class="highlighter-rouge">IDepartmentDataSource</code> with getters of type <code class="highlighter-rouge">IQueryable&lt;T&gt;</code>. In the actual db context class, the implementation of these methods can simply return the <code class="highlighter-rouge">DbSet&lt;T&gt;</code> properties</li>
  <li>Use DI in the controller e.g. StructureMap - initialise scoped to a particular request</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class DepartmentDb : DatabaseContext, IDepartmentDataSource
{
    public DbSet&lt;Employee&gt; Employees { get; set; }
    public DbSet&lt;Department&gt; Departments { get; set; }

    public IQueryable&lt;Employee&gt; IDepartmentDataSource.Employees { get { return Employees; }}
    public IQueryable&lt;Department&gt; IDepartmentDataSource.Departments { get { return Departments; }}
}
</code></pre></div></div>

<ul>
  <li><code class="highlighter-rouge">Enable-Migrations</code> - creates a Migrations folder and add a <code class="highlighter-rouge">Configuration.cs</code> class</li>
  <li>To override the database connection properties, specify the name of the Connection String in the call to the parent DbContext constructor e.g. <code class="highlighter-rouge">: base("DefaultConnection")</code></li>
</ul>

<h2 id="introduction-to-aspnet-mvc-4-part-2">Introduction to ASP.NET MVC 4 Part 2</h2>

<ul>
  <li>View models are more secure to decouple the information received from the user from the inforamtion saved to the database to combat ‚Äúover posting‚Äù or ‚Äúmass assignment‚Äù.</li>
  <li>Add data attributes to the view model to control the display e.g <code class="highlighter-rouge">[Required]</code>, <code class="highlighter-rouge">[HiddenInput(DisplayValue=false)]</code>, <code class="highlighter-rouge">[DataType(DataType.Date)]</code></li>
  <li>Add a <code class="highlighter-rouge">Save</code> method to the context‚Äôs interface which will simply call EF‚Äôs <code class="highlighter-rouge">SaveChanges</code> method for the real interface implementation</li>
</ul>

<h2 id="the-aspnet-webapi">The ASP.NET WebAPI</h2>

<ul>
  <li>Can be self hosted, but using a console project and <code class="highlighter-rouge">Install-Package Microsoft.AspNet.WebApi.SelfHost</code></li>
  <li>API controllers need to inherit from <code class="highlighter-rouge">ApiController</code> rather than <code class="highlighter-rouge">Controller</code></li>
  <li>Will handle verbs GET, POST, PUT, DELETE by default. Other methods available via <code class="highlighter-rouge">[AcceptVerbs]</code>. Looks at the start of an action name.</li>
  <li>If you try to send a DELETE request to particular web servers, it may not be able to handle it and will return a message ‚ÄúFile or directory does not exist on the server‚Äù e.g. IIS Express
    <ul>
      <li>to reconfigure IIS Express to accept other verbs, go to C:\Users\Claire\Documents\IISExpress\config\applicationhost.config - check for key <code class="highlighter-rouge">ExtensionlessUrl-Integrated-4.0</code> - by default only GET, HEAD, POST and DEBUG are specified. Add PUT and DELETE to the list. Save and try again.</li>
    </ul>
  </li>
</ul>

<h3 id="content-negotiation">Content negotiation</h3>

<ul>
  <li>Simple objects are returned (rather than action results or view results in MVC). The format of the response will depend on ‚Äúcontent negotiation‚Äù.</li>
  <li>The <code class="highlighter-rouge">Accept</code> header in the request asks for the content in a particular format e.g. <code class="highlighter-rouge">image/png</code> (other headers exist to specify lanuage, encoding and character set)</li>
  <li>Set breakpoint at start of action method, go to intermediate window: <code class="highlighter-rouge">GlobalConfiguration</code> and then <code class="highlighter-rouge">GlobalConfiguration.Configuration</code> and finally <code class="highlighter-rouge">GlobalConfiguration.Configuration.Formatters</code> to show the 4 default formatters. Objects returned are turned into specific representations by one of these formatters.</li>
</ul>

<h3 id="parameter-binding">Parameter binding</h3>

<ul>
  <li>Also different to MVC</li>
  <li>For primitive types, the WebAPI runtime will look in the URL and query string, but NOT in the message body by default
    <ul>
      <li>Add the <code class="highlighter-rouge">[FromBody]</code>  attribute in front of the type e.g. <code class="highlighter-rouge">public void Post([FromBody]string value) { ... }</code></li>
    </ul>
  </li>
  <li>For complex types, these are expected to be in the body of a request e.g. a PUT or a POST</li>
  <li>The content-type of the request will determine which formatter is chosen to parse the body
    <ul>
      <li>Pass the body to curl using -d e.g. curl http://localhost:5000/api/videos/ -X POST -d ‚Äú=scott‚Äù</li>
      <li>For single parameters just use an <code class="highlighter-rouge">=</code> sign (as above), for complex objects, e.g. <code class="highlighter-rouge">id=1&amp;title=mvc4</code> would work for an object with an id and a title (using the Form encoded data formatter)</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">db.Configuration.ProxyCreationEnabled = false;</code> - proxy creation helps with change tracking and lazy loading - but no reason to enable this for an API if you are getting data from the database and immediately sending to the client OR receiving data from the client and immediately saving to the database.</li>
  <li>The default <code class="highlighter-rouge">_Layout.cshtml</code> contains a <code class="highlighter-rouge">@RenderSection("scripts", required: false)</code> at the bottom of the page, so each pages can specify custom scripts or inlude script tags if required.</li>
  <li>Can use the razor syntax within JS to form URLs e.g. <code class="highlighter-rouge">var apiUrl = '@Url.RouteUrl("DefaultApi", new { httproute="", controller="videos" })</code> - the <code class="highlighter-rouge">httproute</code> property doesn‚Äôt have to be set to anything, but must be present in order for the runtime to correctly resolve the route to the controller</li>
  <li>Useful to set up a global AJAX error handler so that if anything at all goes wrong AJAXwise, an alert can be displayed to aid debugging: <code class="highlighter-rouge">$(document).ajaxError(function (event, xhr) { alert(xhr.status + ":" + xhr.statusText); });</code></li>
  <li><code class="highlighter-rouge">throw new HttpResponseException(Request.CreateResponse(HttpStatusCode.NotFound));</code> to return a 404 from an API</li>
  <li><code class="highlighter-rouge">$(document).on("click", ".editVideo", editVideo)</code> - using the jQuery <code class="highlighter-rouge">on</code> method, you can wire up objects that don‚Äôt yet exist</li>
  <li><code class="highlighter-rouge">db.Entry(video).State = EntityState.Modified</code> to update an existing entry followed by <code class="highlighter-rouge">db.SaveChanges()</code></li>
</ul>
:ET